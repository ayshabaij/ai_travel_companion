<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
    <style type="text/css">
        .photography-wrapper {
            border-radius: 100px;
            border: 2px solid #dee0e7;
            display: inline-flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            padding: 6px 12px;
            margin: 3px; /* Reduced margin */
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            font-size: 14px; /* Adjust font size if needed */
            flex: 0 0 auto; /* Allow flexibility for fitting in container */
        }
        .photography-wrapper.selected {
            background-color: #ea5b6e;
            border-color: #ea5b6e;
            color: #fff;
        }
        .frame-parent {
            position: absolute;
            top: 232px;
            left: 45px;
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: flex-start;
            flex-wrap: wrap;
            gap: 6px; /* Reduced gap */
            max-width: 90%; /* Adjust max-width to fit the design */
            height: 400px; /* Set a fixed height for the container */
            overflow-y: auto; /* Enable vertical scrolling */
            padding-right: 10px; /* Add some padding to the right for better appearance */
        }
        .interests-child {
            position: absolute;
            top: 66px;
            left: 29px;
            width: 9.1px;
            height: 18.1px;
        }
        .hobbies {
            position: absolute;
            top: 100px;
            left: 63px;
            font-size: 38.29px;
            letter-spacing: 0.04em;
            line-height: 140%;
            font-weight: 600;
            color: #010001;
        }
        .let-everyone-know-container {
            position: absolute;
            top: 170px;
            left: 63px;
            font-size: 13.19px;
            line-height: 17.06px;
            font-weight: 500;
            color: #c6c5c7;
        }
        .continue-24-wrapper {
            position: absolute;
            top: 750px;
            left: 40px;
            border-radius: 67.18px;
            background-color: #ebecef;
            width: 312.4px;
            height: 50.4px;
            overflow: hidden;
            font-size: 18.14px;
            color: #828491;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: not-allowed; /* Disabled initially */
        }
        .continue-24-wrapper.active {
            cursor: pointer; /* Enabled state */
            background-color: #ea5b6e;
            color: #fff;
        }
        .interests-item {
            position: absolute;
            top: 46px;
            left: 0px;
            background-color: #d9d9d9;
            width: 393px;
            height: 4px;
        }
        .interests-inner {
            position: absolute;
            top: 46px;
            left: 0px;
            background-color: #ea4080;
            width: 247px;
            height: 4px;
        }
        .interests {
            width: 100%;
            position: relative;
            background-color: #fff;
            height: 852px;
            text-align: left;
            font-size: 14.98px;
            color: #bfc3cf;
            font-family: Inter;
        }
        body {
            margin: 0;
            line-height: normal;
        }
    </style>
</head>
<body>

<div class="interests">
    <div class="frame-parent">
        <% @hobbies.each do |hobby| %>
            <div class="photography-wrapper" data-hobby-name="<%= hobby.name %>">
                <%= hobby.name %>
            </div>
        <% end %>
    </div>
    <img class="interests-child" alt="" src="/assets/Vector 2524.svg">
    <div class="hobbies">Hobbies</div>
    <div class="let-everyone-know-container">
        <p class="let-everyone-know">Let everyone know what youâ€™re interested</p>
        <p class="let-everyone-know">in by adding it to your profile. Please add up to 5</p>
    </div>
    <div class="continue-24-wrapper" id="submit-btn">
        <b class="continue-24">CONTINUE 2/4</b>
    </div>
    <div class="interests-item"></div>
    <div class="interests-inner"></div>
</div>

<form id="hobbies-form" action="<%= update_hobbies_profile_path %>" method="post" style="display: none;">
    <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
</form>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var selectedHobbies = new Set();
        var maxHobbies = 5;
        var submitButton = document.getElementById('submit-btn');
        console.log('Document loaded.');

        function updateSubmitButtonState() {
            if (selectedHobbies.size > 0) {
                submitButton.classList.add('active');
            } else {
                submitButton.classList.remove('active');
            }
        }

        document.querySelectorAll('.photography-wrapper').forEach(function(button) {
            button.addEventListener('click', function() {
                var hobbyName = this.getAttribute('data-hobby-name');
                console.log('Hobby clicked:', hobbyName);
                if (selectedHobbies.has(hobbyName)) {
                    selectedHobbies.delete(hobbyName);
                    this.classList.remove('selected');
                } else if (selectedHobbies.size < maxHobbies) {
                    selectedHobbies.add(hobbyName);
                    this.classList.add('selected');
                }
                console.log('Selected hobbies:', Array.from(selectedHobbies));
                updateSubmitButtonState();
            });
        });

        submitButton.addEventListener('click', function() {
            if (!submitButton.classList.contains('active')) return;
            console.log('Submit button clicked.');
            var form = document.getElementById('hobbies-form');
            selectedHobbies.forEach(function(hobbyName) {
                var input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'hobby_names[]';
                input.value = hobbyName;
                form.appendChild(input);
            });
            console.log('Form data:', new FormData(form));

            // AJAX request to another Ruby application
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:4567/receive_data", true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log('API response:', xhr.responseText);
                    form.submit();
                } else if (xhr.readyState === 4) {
                    console.error('API request failed:', xhr.status, xhr.statusText);
                }
            };

            var payload = { hobby_names: Array.from(selectedHobbies) };
            console.log('Sending API request with payload:', JSON.stringify(payload));
            xhr.send(JSON.stringify(payload));
        });
    });
</script>

</body>
</html>
